<!--
  * ÌååÏùºÎ™Ö : SetAccountDetail.vue
  * ÌååÏùº Í∏∞Îä• : Í≥ÑÏ†ï Í¥ÄÎ¶¨ ÏÉÅÏÑ∏ + ÏÉÅÏÑ∏ ÏàòÏ†ï Í∏∞Îä•
  * ÏûëÏÑ±Ïûê : ·Ñã·Öµ·ÑÄ·Öß·Üº·Ñí·Ö™·Ü´ Ïô∏ 3Î™Ö
  * ÏµúÏ¢Ö ÏûëÏÑ±Ïùº : 2021-02-26
  * License By Shinsegae I&C
  * 2021-02-26 fix: Î∂ÄÏÑú Ï∂îÍ∞Ä Î≤ÑÌäº ÏúÑÏπò Í∞úÏÑ†
 -->

<template>
  <div class="set-account-detail">
    <!-- style="border:1px solid red;" -->
    <section
      v-if="loading || !isDataLoaded"
      style="height:500px;"
      v-loading="loading"
    />
    <section
      v-else
      class="edit-area"
      v-loading="loading"
    >
      <div
        v-if="isCmpUser"
        class="edit-info-list"
      >
        <register-contents
          type="input"
          :title="$t('common.REGCON.changePw')"
          v-if="isAdmin() && !otp"
        >
          <button
            type="is-primary"
            class="button -confirm"
            @click="otpModalActive = !otpModalActive"
          >
            {{ $t('common.BTN.authOtp') }}
          </button>
        </register-contents>
        <!-- /. OTP Ïù∏Ï¶ù -->

        <register-contents
          type="input"
          :title="$t('common.REGCON.newPw')"
          required
          v-if="isAdmin() && otp"
        >
          <div class="flex-wrap">
            <el-input
              class="information-input"
              placeholder="ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî."
              v-model="user.userPw"
              show-password
            />
            <span class="pw-info">{{ $t('common.PLACEHOLDER.pwValid') }} (&nbsp;&#33;&nbsp;&#35;&nbsp;&#36;&nbsp;&#37;&nbsp;&#38;&nbsp;&#42;&nbsp;&#63;&nbsp;&#64;&nbsp;) {{ $t('common.PLACEHOLDER.pwValidRight') }}</span>
          </div>
        </register-contents>
        <!-- /. ÎπÑÎ∞ÄÎ≤àÌò∏ -->

        <register-contents
          type="input"
          :title="$t('common.REGCON.newRePw')"
          required
          v-if="isAdmin() && otp"
        >
          <el-input
            class="information-input"
            :placeholder="$t('common.PLACEHOLDER.enterNewRePw')"
            v-model="userPasswordRe"
            show-password
          />
        </register-contents>
      <!-- /. ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏ -->
      </div>
      <!-- /. OTP Ïù∏Ï¶ù, ÎπÑÎ∞ÄÎ≤àÌò∏, ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏ (Ïö¥ÏòÅ Í¥ÄÎ¶¨ÏûêÏö©) -->

      <div class="edit-info-list">
        <register-contents
          type="input"
          :title="$t('common.TERMS.rel')"
          required
        >
          <!-- v-if="companyList && companyList.length" -->
          <el-select
            class="information-input"
            v-model="user.userCompany"
            :popper-append-to-body="false"
            :placeholder="$t('admin.ACCOUNT.selectAff')"
            @change="userCompanyChange"
            :disabled="!isCmpUser"
          >
            <!-- :disabled="isSsg" -->
            <el-option
              v-for="item in companyList"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            />
          </el-select>
        </register-contents>
        <!-- /. Í¥ÄÍ≥ÑÏÇ¨ -->

        <register-contents
          type="input"
          :title="$t('common.TERMS.group')"
          required
        >
          <!-- v-if="userGroupList != null" -->
          <el-select
            class="information-input"
            v-model="user.userGroup"
            :placeholder="$t('common.PLACEHOLDER.selectOrg')"
            @change="checkUserGroupValid(user.userGroup)"
            :disabled="!isCmpUser"
          >
            <template v-for="item in userGroupList">
              <el-tooltip
                v-if="item.groupUpperName"
                :key="item.value"
                :content="item.groupUpperName"
                placement="left"
                effect="light"
              >
                <el-option
                  :label="item.label"
                  :value="item.value"
                />
              </el-tooltip>
              <el-option
                v-else
                :key="item.value"
                :label="item.label"
                :value="item.value"
              />
            </template>
          </el-select>
        </register-contents>
        <!-- /. Ï°∞ÏßÅ -->

        <register-contents
          type="input"
          :title="$t('common.GRID.pressure')"
          required
        >
          <div class="input-form">
            <el-input
              :placeholder="$t('config.IP.enter', { name: $t('common.GRID.pressure') })"
              v-model="user.userId"
              disabled
            />
          </div>
        </register-contents>
        <!-- /. ÏÇ¨Î≤à -->

        <register-contents
          type="input"
          :title="$t('common.MODAL.name')"
          required
        >
          <el-input
            class="information-input"
            v-model="user.userName"
            :disabled="isSsg"
          />
        </register-contents>
        <!-- /. Ïù¥Î¶Ñ -->

        <register-contents
          type="input"
          :title="$t('admin.ACCOUNT.position')"
          required
        >
          <el-select
            class="information-input"
            v-model="user.userPosition"
            :popper-append-to-body="true"
            :placeholder="$t('common.BTN.select')"
            :disabled="isSsg"
          >
            <el-option
              v-for="item in positionList"
              :key="item.field"
              :label="item.label"
              :value="item.field"
            />
          </el-select>
        </register-contents>

        <register-contents
          type="input"
          :title="$t('admin.ACCOUNT.email')"
        >
          <el-input
            class="information-input"
            :placeholder="$t('config.IP.enter', { name: $t('admin.ACCOUNT.email') })"
            :disabled="!isCmpUser"
            v-model="user.userEmail"
          />
        </register-contents>
        <!-- /. Ïù¥Î©îÏùº -->

        <register-contents
          v-if="!isCmpUser"
          type="input"
        >
          <p class="data-empty">
            {{ $v('CMPÏóê Îì±Î°ùÏù¥ ÌïÑÏöîÌïú Í≥ÑÏ†ï ÏûÖÎãàÎã§.') }}
          </p>
        </register-contents>
        <!-- /. ÏßÅÏúÑ -->

        <!-- v-if="!isSsg || user.userEmail" -->

        <register-contents
          v-if="isCmpUser"
          type="input"
          :title="$t('admin.NOTI.phone')"
        >
          <el-input
            class="information-input -phone"
            :placeholder="$t('config.IP.enter', { name: $t('admin.NOTI.phone') })"
            v-model="user.userPhone"
            :maxlength="13"
          />
        </register-contents>
        <!-- /. Ìú¥ÎåÄÏ†ÑÌôî -->
        <!-- Ìú¥ÎåÄÏ†ÑÌôî ÏãúÏïàÏóê ÏóÜÏùå -->
      </div>
      <!-- /. Í¥ÄÍ≥ÑÏÇ¨, Ï°∞ÏßÅ, ÏÇ¨Î≤à, Ïù¥Î¶Ñ, ÏßÅÏúÑ, Ïù¥Î©îÏùº, Ìú¥ÎåÄÏ†ÑÌôî -->
      <div
        v-if="isCmpUser"
        class="edit-info-list"
      >
        <register-contents
          type="input"
          required
          :title="$t('admin.ACCOUNT.state')"
        >
          <el-select
            class="information-input"
            v-model="user._userStatus"
            :popper-append-to-body="true"
            :placeholder="$t('common.BTN.select')"
          >
            <el-option
              v-for="item in activeList"
              :key="item.field"
              :label="$t(item.keyPath) || item.label"
              :value="item.field"
            />
          </el-select>
        </register-contents>
        <!-- /. Í≥ÑÏ†ï ÏÉÅÌÉú -->

        <register-contents
          type="input"
          :title="$t('admin.ACCOUNT.perm')"
          required
        >
          <!-- ‚≠êÔ∏è ÎîîÎ≤ÑÍπÖ :: {{ user._tempUserPermLv }} -->
          <div class="input-form">
            <el-radio-group
              v-if="editUser.field === 'admin'"
              v-model="user._tempUserPermLv"
            >
              <el-radio
                v-for="perm in admPermLevels"
                :key="perm.value"
                :label="perm.value"
                style="margin-right: 20px;"
              >
                <!-- // 0 ÏµúÍ≥†Í¥ÄÎ¶¨Ïûê, 1 Ïö¥ÏòÅÍ¥ÄÎ¶¨Ïûê -->
                {{ perm.label }}
              </el-radio>
            </el-radio-group>
            <!-- /. üåô Ïö¥ÏòÅ Í¥ÄÎ¶¨ÏûêÍ≥ÑÏ†ï Ïùº Îïå -->

            <el-radio-group
              v-else
              v-model="user._tempUserPermLv"
              :disabled="user.userPermLevel === 2"
              @change="setMultiUser"
            >
              <el-radio
                v-for="perm in userPermLevels"
                :key="perm.value"
                :label="perm.value"
                style="margin-right: 20px;"
                :disabled="perm.value === 2 || changedOrgOrAff"
              >
                <!-- 2 Ï§ëÍ∞ÑÍ¥ÄÎ¶¨Ïûê, 3 ÎπåÎßÅÏÇ¨Ïö©Ïûê, 4, ÏùºÎ∞ò ÏÇ¨Ïö©Ïûê, 5 Ïª§Ïä§ÌÖÄ ÏÇ¨Ïö©Ïûê, 6 ÌòëÎ†•ÏÇ¨ -->
                <!-- {{ perm.value }} :: -->
                {{ perm.label }}
              </el-radio>
            </el-radio-group>

            <!-- /. üåû ÏÇ¨Ïö©ÏûêÍ≥ÑÏ†ï Ïùº Îïå -->
          </div>
        </register-contents>
        <!-- /. Í∂åÌïú -->

        <register-contents
          type="input"
          :title="$t('admin.ROLE.role')"
          required
          v-if="isAdmin() && user._tempUserPermLv === 1"
        >
          <div class="input-form -role">
            <div>
              <div
                class="form-role"
                v-for="(role, index) in user.userPermRole"
                :key="index"
              >
                <el-select
                  class="information-input"
                  v-model="user.userPermRole[index]"
                  :placeholder="$t('admin.ACCOUNT.selectRole')"
                  @input="checkRoleValid"
                >
                  <el-option
                    v-for="item in roleList"
                    :key="item.value"
                    :label="item.label"
                    :value="item.value"
                  />
                </el-select>
                <a
                  v-if="user.userPermRole.length > 1"
                  class="mdi mdi-minus -delete-button"
                  @click="deleteItem(index, user.userPermRole)"
                />
              </div>
            </div>
            <a
              v-if="user._tempUserPermLv === 1"
              class="mdi mdi-plus -add-button"
              @click="addItem('role')"
            />
          </div>
        </register-contents>
        <!-- /. Ïó≠Ìï† :: üåô Ïö¥ÏòÅÍ¥ÄÎ¶¨ÏûêÏö©  -->
      </div>
      <!-- /. Í≥ÑÏ†ï ÏÉÅÌÉú, Í∂åÌïú, Ï∂îÍ∞Ä Î∂ÄÏÑú, Ïó≠Ìï† -->

      <div
        v-if="isCmpUser"
        class="edit-info-list"
      >
        <register-contents
          type="input"
          :title="$t('admin.ACCOUNT.photo')"
        >
          <div class="photo-form">
            <el-upload
              class="image-uploader"
              action=""
              accept="image/jpeg, image/png, image/jpg"
              :on-change="getFile"
              :on-remove="removeImage"
              :auto-upload="false"
              :multiple="false"
              :file-list="fileList"
            >
              <button
                class="button"
                style="margin-right: 5px;"
              >
                {{ $t('admin.ACCOUNT.upload') }}
              </button>
              <button
                v-if="user.userPhoto"
                class="button"
                type="is-primary"
                @click.stop="removePhotoImage"
              >
                {{ $t('admin.ACCOUNT.deletePhoto') }}
              </button>
              <div
                class="el-upload__tip"
                slot="tip"
              >
                {{ $t('admin.ACCOUNT.limitFileSize') }}
              </div>
            </el-upload>
            <div
              v-if="user.userPhoto"
              class="photo-view"
            >
              <img
                class="photo-image"
                :src="user.userPhoto"
                width="220px"
                height="auto"
                @click="removePhotoImage"
              >
            </div>
          </div>
        </register-contents>
        <!-- ÏÇ¨ÏßÑ -->

        <register-contents
          type="input"
          :title="$t('admin.ACCOUNT.applyDate')"
          v-if="changeAccountAuth(user)"
        >
          <el-input
            class="information-input"
            v-model="user._applyDate"
            disabled
          />
        </register-contents>
        <!-- /. Ïã†Ï≤≠Ïùº (ÏÉÅÌÉú) -->

        <register-contents
          type="input"
          :title="$t('admin.ACCOUNT.loginLock')"
        >
          <el-checkbox v-model="user.loginLock" />
        </register-contents>
        <!-- /. Î°úÍ∑∏Ïù∏ Ïû†Í∏à -->

        <register-contents
          v-if="!isAdmin()"
          type="input"
          :title="$v('ÎπåÎßÅ Îã¥ÎãπÏûê')"
        >
          <el-checkbox v-model="user.isBilling" />
        </register-contents>
        <!-- /. ÎπåÎßÅ Î∞§ÎãπÏûê -->

        <register-contents
          type="input"
          :title="$t('admin.ACCOUNT.regDate')"
        >
          <div class="flex-wrap">
            <el-input
              class="information-input"
              disabled
              v-model="user._createTime"
            />

            <a
              v-if="!isAdmin()"
              style="margin-left: 10px;"
              @click="openUserLogin(user.userId)"
            >
              <button
                class="button"
                type="is-primary"
                :disabled="user.userStatus !== 3"
              >
                {{ $t('common.BTN.userLogin') }}
              </button>
            </a>
          </div>
        </register-contents>
        <!-- /. Îì±Î°ùÏùº(ÏµúÍ∑ºÏ†ëÏÜçÏùº) -->
      </div>
      <!-- /. Ïã†Ï≤≠Ïùº(ÏäπÏù∏Ïùº), Î°úÍ∑∏Ïù∏ Ïû†Í∏à, Îì±Î°ùÏùº -->
    </section>

    <div class="big-button-area">
      <button
        class="button -cancel"
        @click="() => {
          loading = true
          $router.go(-1)
        }"
      >
        {{ $v('Î™©Î°ù') }}
      </button>

      <button
        v-if="isCmpUser"
        class="button -confirm"
        type="is-primary"
        @click.stop="applySave"
      >
        {{ $v('Ï†ÄÏû•') }}
      </button>
    </div>

    <otp-modal
      :active="otpModalActive"
      @close="otpModalActive = false"
      @validated-otp="validatedOTP"
    />
  </div>
</template>
<script>
import API from '@sd-fe/cmp-core'
import OTPModal from '@/components/Modal/OTPModal/OTPModal'
import { isEqual, cloneDeep, pick } from 'lodash'
import { mapState } from 'vuex'
import 'vue-virtual-scroller/dist/vue-virtual-scroller.css'
import Dayjs from 'dayjs'
import { validatorUserId, validatorUserName } from '@/components/AccountMixins/AccountMixins'

export default {
  name: 'SetAccountDetail',
  components: {
    'otp-modal': OTPModal
  },
  async created () {
    // Ïã†ÏÑ∏Í≥Ñ (ÏÇ¨Î≤à, Ïù¥Î¶Ñ Í∞ÄÏûÖ) vs Ïù¥Î©îÏùº/Ïó∞ÎùΩÏ≤òÎ°ú Í∞ÄÏûÖ ÌôïÏù∏
    const ssgEnv = process.env.VUE_APP_SSG_USER === 'true'
    if (ssgEnv) this.isSsg = ssgEnv
  },
  async mounted () {
    this.loading = true

    this.groupManageTree = await this.initGetGroupManageTree()
    await this.getGroupManageTree()

    // üåû ÏÇ¨Ïö©ÏûêÍ≥ÑÏ†ï, üåô Ïö¥ÏòÅÍ¥ÄÎ¶¨Ïûê Í≥ÑÏ†ï Í≥µÌÜµ
    // [Í¥ÄÍ≥ÑÏÇ¨] Î¶¨Ïä§Ìä∏ ÏÑ§Ï†ï
    const list = await this.getGroups({ groupUpper: 0 })
    this.companyList = await this.labelSort(list)

    this.setEditUser()
    await this.getUserInfo()
    await this.getRoleList()
    this.setActiveList(this.user)

    this.settingFin = true
  },
  computed: {
    ...mapState({
      admin: state => state.auth.user // ÌòÑÏû¨ Ï†ëÏÜçÌï¥ÏûàÎäî Í¥ÄÎ¶¨Ïûê
    }),
    isCmpUser () {
      return !!this.user.userIdx
    }
  },
  watch: {
    user: {
      deep: true,
      handler (newVal) {
        if (newVal.userPw?.length === 0) { delete newVal.userPw }
        this.isChange = !isEqual(this.rawUserData, newVal)

        if (newVal.userPermLevel === 3) {
          if (newVal.addPermGroup && !newVal.addPermGroup.length) {
            newVal.addPermGroup = []
          }
        }
      }
    },
    'user.userCompany': function (newVal, oldVal) {
      if (oldVal && oldVal.length !== 0) {
        this.resetUserAuthority()
      }
      this.getGroupEmailDomain(newVal)// Ïù¥Î©îÏùº Î≥ÄÍ≤ΩÏùÑ ÏúÑÌïú Ïù¥Î©îÏùº ÎèÑÎ©îÏù∏ÏùÑ Í∞ÄÏ†∏ÏòµÎãàÎã§. console.log('@user.userCompany : ', val)
    },
    'user.userGroup': function (newVal, oldVal) {
      if (oldVal && oldVal.length !== 0) {
        this.resetUserAuthority()
      }
    },
    'user._tempUserPermLv' (value) {
      if (this.isAdmin() && value === 1) {
        if (!this.user.userPermRole || !this.user.userPermRole.length) {
          this.user.userPermRole = ['']
        }
      }
    }
  },
  methods: {
    removePhotoImage () {
      this.$confirm('ÏÇ¨ÏßÑÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')
        .then(() => {
          this.user.userPhoto = undefined
        })
        .catch(() => false)
    },
    getBase64 (file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader()
        let imgResult = ''
        reader.readAsDataURL(file)
        reader.onload = () => {
          imgResult = reader.result
        }
        reader.onerror = (err) => {
          reject(err)
        }
        reader.onloadend = () => {
          resolve(imgResult)
        }
      })
    },
    getFile (file, fileList) {
      if (fileList.length > 1) this.fileList = fileList.slice(-1)

      if (file.size > (1024 * 1024 * 20)) { // 20Mb Ïù¥Ìïò ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•
        this.$alert(this.$t('common.ALERT.ACCOUNT.003'))
        this.removeImage()
      } else {
        this.getBase64(file.raw).then(res => {
          this.user.userPhoto = res
          this.toUrl(file.raw)
        }, rejected => {
          this.$alert(this.$t('common.ALERT.BASE.046'))
          console.error(rejected)
        })
      }
    },
    removeImage () {
      this.user.userPhoto = undefined
    },
    async getGroupEmailDomain (userCompanyIdx) {
      const registeredDomain = this.groupManageTree.find(company => company.groupIdx === userCompanyIdx)
      if (registeredDomain) this.groupEmailDomain = registeredDomain.companyDomain
      console.log('@ ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÎèÑÎ©îÏù∏', this.groupEmailDomain)
    },
    validatedOTP () {
      this.otpModalActive = false
      this.otp = true
    },
    routeTo (to) {
      this.$router.push(to)
    },
    /**
     * url ÏóêÏÑú Ìé∏ÏßëÌï† ID Î∞è Ï†ïÎ≥¥ Î•º Ï∂îÏ∂úÌï©ÎãàÎã§
     */
    setEditUser () {
      const routeField = this.$route.path.split('/')[4]
      const routeId = this.$route.params.id
      this.editUser = {
        field: routeField,
        userId: routeId
      }
    },
    /**
     * user Í∂åÌïúÏùÑ ÌôïÏù∏ÌïòÏó¨ [Í≥ÑÏ†ï ÏÉÅÌÉú] ÏòµÏÖòÏùÑ ÏÑ§Ï†ïÌï©ÎãàÎã§.
     * ÎπåÎßÅÏÇ¨Ïö©Ïûê(ÏäπÏù∏ÎåÄÍ∏∞) Ïù∏Í≤ΩÏö∞ ÏòµÏÖò Î™©Î°ùÏóê [ÏäπÏù∏ ÎåÄÍ∏∞] Ï∂îÍ∞Ä + ÏûêÎèôÏúºÎ°ú Í≥ÑÏ†ïÏÉÅÌÉú [ÏäπÏù∏ ÎåÄÍ∏∞] ÏÑ†ÌÉù
     * Í∑∏ Ïô∏ ÏÇ¨Ïö©ÏûêÏùºÍ≤ΩÏö∞Îäî ÏòµÏÖò Î™©Î°ùÏóê [ÏäπÏù∏ ÎåÄÍ∏∞] ÏÇ≠Ï†ú + Í∏∞Ï°¥ Ï†ïÎ≥¥Î°ú Í≥ÑÏ†ïÏÉÅÌÉú Î≥ÄÍ≤Ω
     */
    setActiveList (user) {
      // ÌòÑÏû¨ ÏÉÅÌÉúÍ∞Ä ÏùºÎ∞òÏÇ¨Ïö©Ïûê(4) + ÏäπÏù∏ ÎåÄÍ∏∞ (UI ÏóêÏÑúÎäî => ÎπåÎßÅÏÇ¨Ïö©Ïûê(3) + ÏäπÏù∏ÎåÄÍ∏∞ ÏÉÅÌÉú) Ïùº Îïå
      if (user._tempUserPermLv === 3 && user.requestStatus === 0 && user.userStatus !== 0) {
        this.activeList.splice(1, 0, { field: 1, label: 'ÏäπÏù∏ÎåÄÍ∏∞', keyPath: 'admin.ACCOUNT.waitApproval' })
        user._userStatus = 1 // Í≥ÑÏ†ïÏÉÅÌÉú :: ÏäπÏù∏ÎåÄÍ∏∞Î°ú ÌëúÏãú
      } else {
        this.activeList = this.activeList.filter(status => status.field !== 1)
        user._userStatus = user.requestStatus === 0 && user.userStatus !== 0 ? 3 : user.userStatus // Í≥ÑÏ†ïÏÉÅÌÉú :: Í∏∞Ï°¥Ïùò Ï†ïÎ≥¥Î°ú Ïú†ÏßÄ
      }
    },
    /**
     * Í¥ÄÍ≥ÑÏÇ¨, Ï°∞ÏßÅ Î≥ÄÍ≤ΩÏãú Í∂åÌïú Ï†ïÎ≥¥ Ï¥àÍ∏∞Ìôî Î∞è disabled
     */
    resetUserAuthority () {
      if (this.changedOrgOrAff) return
      if (!this.isAdmin()) {
        this.user.userPermLevel = 4 // ÏùºÎ∞ò ÏÇ¨Ïö©ÏûêÎ°ú Î≥ÄÍ≤Ω
        this.user._tempUserPermLv = 4 // ÏùºÎ∞ò ÏÇ¨Ïö©ÏûêÎ°ú Î≥ÄÍ≤Ω
      }
      this.user.isMultiUser = false // Î©ÄÌã∞ Ïú†Ï†Ä Ìï¥Ï†ú
      this.changedOrgOrAff = true // Í¥ÄÍ≥ÑÏÇ¨, Ï°∞ÏßÅ Î≥ÄÍ≤ΩÎêòÏóàÎäîÍ∞Ä
      this.userGroupMapMultiList = [] // Î©ÄÌã∞ ÏÇ¨Ïö©Ïûê Ï∂îÍ∞Ä Î∂ÄÏÑú ÎπÑÏõÄ
      this.userGroupMapCustomList = [] // Ïª§Ïä§ÌÖÄ ÏÇ¨Ïö©Ïûê Ï∂îÍ∞Ä Î∂ÄÏÑú ÎπÑÏõÄ
    },
    /**
     * User Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
     */
    async getUserInfo () {
      // if (this.editUser.field === 'new') return // Ïã†Í∑úÏÉùÏÑ±
      if (!this.editUser) return

      const { userId, field } = this.editUser
      const response = await API.iam.getUserInfo({ userId, isAdmin: field === 'admin' })

      if (response) {
        // Í∞ÄÏ†∏Ïò® Ïú†Ï†Ä Ï†ïÎ≥¥Ïùò [Ï°∞ÏßÅ] ÏÑ§Ï†ï
        if (response[0]?.userCompany) this.userGroupList = await this.getGroups({ companyIdx: response[0].userCompany }) // ÏÜåÏÜçÎ∂ÄÏÑú Í∑∏Î£π Î¶¨Ïä§Ìä∏
        this.user.addPermGroup = []

        await this.setUserInfo(response[0])

        // Breadcrumbs ÏÑ∏ÌåÖ
        this.$store.commit('common/ADD_PARAMETERS', { label: userId, path: '' })
      } else {
        this.$alert(this.$t('common.ALERT.ACCOUNT.024')) // Ìï¥Îãπ Í≥ÑÏ†ï Ï†ïÎ≥¥Í∞Ä Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏäµÎãàÎã§.
        return this.$router.push({ name: 'set-account' })
      }
    },
    /**
     * Ï¥àÍ∏∞ Ïú†Ï†Ä Ï†ïÎ≥¥ ÏÑ∏ÌåÖ
     */
    async setUserInfo (user) {
      const formatDate = date => Dayjs(date).format('YYYY.MM.DD')
      const formatDateSec = date => Dayjs(date).format('YYYY.MM.DD HH:mm:ss')

      // Îì±Î°ùÏùº(ÏµúÍ∑ºÏ†ëÏÜçÏùº)
      const createDate = formatDate(user.createTime)
      const lastLoginTime = user.latestLoginTime ? formatDateSec(user.latestLoginTime) : this.$t('common.ALERT.ACCOUNT.050') // ÏµúÍ∑º Ï†ëÏÜç Ïù¥Î†•Ïù¥ ÏóÜÏäµÎãàÎã§.
      user._createTime = `${createDate} (${lastLoginTime})`

      // Ìé∏ÏßëÏö© userPermLevel Îç∞Ïù¥ÌÑ∞ :: _tempUserPermLv
      let _tempUserPermLv = user.userPermLevel
      const _userStatus = user.userStatus // Í≥ÑÏ†ï ÏÉÅÌÉú Î≥µÏÇ¨

      // Ïã†Ï≤≠Ïùº(ÏäπÏù∏Ïùº) Îç∞Ïù¥ÌÑ∞ ÏÑ∏ÌåÖ => ÏäπÏù∏ ÎåÄÍ∏∞Ï§ëÏù∏ ÎπåÎßÅÏÇ¨Ïö©Ïûê Ï†ÑÏö©
      if (user.registerDate !== undefined) {
        // ÏäπÏù∏ÎåÄÍ∏∞Ï§ëÏù∏ ÎπåÎßÅÏÇ¨Ïö©ÏûêÎäî [ÏùºÎ∞òÏÇ¨Ïö©Ïûê] Í∂åÌïú => UI ÏóêÏÑ† ÎπåÎßÅÏÇ¨Ïö©ÏûêÎ°ú ÌëúÍ∏∞
        if (user.requestStatus !== undefined && user.requestStatus === 0) _tempUserPermLv = 3

        // ÏäπÏù∏ ÏÉÅÌÉú
        const date = {
          0: this.$t('admin.ACCOUNT.waitApproval'), // ÏäπÏù∏ ÎåÄÍ∏∞
          1: formatDateSec(user.approvalDate), // ÏäπÏù∏ ÏôÑÎ£å
          2: `ÎπåÎßÅ ÏÇ¨Ïö©Ïûê Î∞òÎ†§: ${formatDateSec(user.approvalDate)}`// ÏäπÏù∏ Î∞òÎ†§
        }[user.requestStatus]

        const regDate = formatDate(user.registerDate) // Ïã†Ï≤≠Ïùº
        user._applyDate = `${regDate} (${date})`
      }

      this.rawUserData = await cloneDeep(user)
      this.user = { ...user, _tempUserPermLv, _userStatus }

      console.log('@@', this.user)

      this.isDataLoaded = true
    },

    /**
     * Ïª§Ïä§ÌÖÄÏÇ¨Ïö©Ïûê, Î©ÄÌã∞ÏÇ¨Ïö©ÏûêÏùò Í≤ΩÏö∞ Ï∂îÍ∞ÄÎ∂ÄÏÑú ÏÑ§Ï†ï
     */
    //  Ï∂îÍ∞Ä Î∂ÄÏÑú ÌÅ¥Î¶≠ Ïãú *** ÏÇ≠Ï†ú ÏòàÏ†ï ***

    /**
   * [ÏÇ¨Ïö©Ïûê Î°úÍ∑∏Ïù∏] Í∏∞Îä•
   */
    async openUserLogin (userId) {
      try {
        this.loading = true
        const userToken = await API.iam.getUserLoginToken(userId)

        if (userToken) {
          const configUrl = process.env.VUE_APP_USER_URL // ÏÇ¨Ïö©Ïûê URL
          // return window.open(`https://web-usr-e.growthsoft.co.kr/login/admin-login//${userToken}`, '_blank')
          // console.log(`${configUrl}/login/admin-login/${userToken}`)
          // return window.open(`${'http://192.168.11.102:8083'}/login/admin-login/${userToken}`, '_blank')
          return window.open(`${configUrl}/login/admin-login/${userToken}`, '_blank')
        }
      } catch (error) {
        console.error('@@ openUserLogin : ', error)
      } finally {
        this.loading = false
      }
    },

    // ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è
    // ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è
    // ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è

    /**
     * üåô Ïö¥ÏòÅÍ¥ÄÎ¶¨Ïûê Í≥ÑÏ†ïÏö©
     * [Ïó≠Ìï†] Ï∂îÍ∞Ä
     */
    addItem (field) {
      if (field === 'role') {
        const newObj = ''
        this.user.userPermRole.push(newObj)
      } else if (field === 'group') {
        if (this.tempAddDepartData.companyIdx !== null && this.tempAddDepartData.groupIdx !== null) {
          this.loading = true
          setTimeout(() => {
            this.user.addPermGroup.unshift(this.tempAddDepartData)
            this.user.addPermGroup = cloneDeep(this.user.addPermGroup)
            this.tempAddDepartData = {
              companyIdx: null,
              companyName: null,
              groupIdx: null,
              groupName: null
            }
            this.loading = false
            console.log('@addItem', this.user.addPermGroup)
          }, 500)
        } else {
          this.$alert(this.$t('admin.ACCOUNT.selectAdditionalDepart'))
        }
      }
      this.$forceUpdate()
    },
    /**
     * üåô Ïö¥ÏòÅÍ¥ÄÎ¶¨Ïûê Í≥ÑÏ†ïÏö©
     * [Ïó≠Ìï†] ÏÇ≠Ï†ú
     */
    deleteItem (deleteIdx, list, deleteDepart = false) {
      if (deleteDepart) {
        this.user.addPermGroup = list.filter(dep => dep.groupIdx !== deleteIdx)
      } else {
        list.splice(deleteIdx, 1)
      }
      this.$forceUpdate()
    },
    /**
     * üåû ÏÇ¨Ïö©ÏûêÍ≥ÑÏ†ï, üåô Ïö¥ÏòÅÍ¥ÄÎ¶¨Ïûê Í≥ÑÏ†ï Í≥µÏö©
     * [Í¥ÄÍ≥ÑÏÇ¨] Î≥ÄÍ≤ΩÏãú Î∞úÏÉùÌïòÎäî Ïù¥Î≤§Ìä∏
     */
    async userCompanyChange (userCompany) {
      // ÏÑ†ÌÉùÌïú Ï°∞ÏßÅ Ï¥àÍ∏∞Ìôî
      this.user.userGroup = null
      // ÏÑ†ÌÉùÌïú Í¥ÄÍ≥ÑÏÇ¨ ÌïòÏúÑÏùò Ï°∞ÏßÅ Î¶¨Ïä§Ìä∏ ÏÑ§Ï†ï
      this.userGroupList = await this.getGroups({ companyIdx: userCompany })

      // ÏÇ¨Ïö©Ïûê Í≥ÑÏ†ïÏùºÎïåÎßå ÎèôÏûë
      if (!this.isAdmin()) {
        this.checkUserGroupValid()
      }
    },
    /**
     * üåô Ïö¥ÏòÅÍ¥ÄÎ¶¨Ïûê Í≥ÑÏ†ïÏö©
     * [Ïó≠Ìï†] Î¶¨Ïä§Ìä∏ Ìò∏Ï∂ú
     */
    async getRoleList () {
      const roleApi = await API.iam.getRoleList()
      this.roleList = roleApi.filter(role => role.roleUpper !== 0).map(role => {
        return { label: role.roleName, value: role.roleIdx }
      })
    },
    /**
     * üåô Ïö¥ÏòÅÍ¥ÄÎ¶¨Ïûê Í≥ÑÏ†ïÏö©
     * [Ïó≠Ìï†] ÏÑ†ÌÉù Î≥ÄÍ≤ΩÏãú ÎèôÏûë
     */
    checkRoleValid () {
      if (this.user.userPermRole.length < 2) return
      const roleSet = new Set()
      for (const role in this.user.userPermRole) {
        if (!this.user.userPermRole[role]) continue
        if (roleSet.has(this.user.userPermRole[role])) {
          // this.$alert('Ï§ëÎ≥µÎêú Ïó≠Ìï†ÏùÑ ÏÑ†ÌÉùÌñàÏäµÎãàÎã§.')
          return this.$alert(this.$t('common.ALERT.ROLE.007'), {
            callback: () => {
              this.user.userPermRole.splice(role, 1)
            }
          })
        }
        roleSet.add(this.user.userPermRole[role])
      }
    },
    /**
     * üåû ÏÇ¨Ïö©ÏûêÍ≥ÑÏ†ï
     * [Ï°∞ÏßÅ] Î≥ÄÍ≤ΩÌï† Îïå Î∞úÏÉùÌïòÎäî Ïù¥Î≤§Ìä∏
     */
    checkUserGroupValid (newVal) {
      // Ï§ëÍ∞ÑÍ¥ÄÎ¶¨ÏûêÏùò Í≤ΩÏö∞, Í¥ÄÍ≥ÑÏÇ¨/Ï°∞ÏßÅÏùÑ Î≥ÄÍ≤ΩÌïòÎ©¥ ÏùºÎ∞òÏÇ¨Ïö©ÏûêÎ°úÎßå Î≥ÄÍ≤ΩÎê©ÎãàÎã§.
      if (this.user.userPermLevel === 2) this.user._tempUserPermLv = 4
    },
    async applySave () {
      // ???
      if (this.user.userPermLevel === 3 && !isEqual(this.rawUserData.userPermGroup, this.user.userPermGroup)) {
        this.user.userStatus = 1
      }
      this.saveFunction()
    },
    async saveFunction () {
      if (!this.userValidation()) return

      this.$confirm(this.$t('common.CONFIRM.ACCOUNT.005'), {
        confirmButtonText: this.$t('common.BTN.confirm'),
        cancelButtonText: this.$t('common.BTN.cancel')
      }).then(async () => {
        const userPermGroup = []
        if (this.user.addPermGroup) {
          this.user.addPermGroup.forEach(e => {
            if (e.groupIdx) { userPermGroup.push(e.groupIdx) }
          })
        }

        // console.log(this.user)
        // debugger
        // ÎîîÎ≤ÑÍπÖÏö©!
        // this.user.userGroupMapMultiList = []
        // this.user.userGroupMapCustomList = []

        this.user.userPermGroup = userPermGroup
        this.user.userPermLevel = this.user._tempUserPermLv // [Í∂åÌïú] ÏÑ§Ï†ï
        this.user.userStatus = this.user._userStatus // [Í≥ÑÏ†ïÏÉÅÌÉú] ÏÑ§Ï†ï

        // ÎπåÎßÅ ÏÇ¨Ïö©Ïûê Ïã†Ï≤≠ ÏäπÏù∏ ÎåÄÍ∏∞ ÏÉÅÌÉúÏùº Îïå Í≥ÑÏ†ï ÏÉÅÌÉúÎ•º ÌôúÏÑ±ÌôîÎ°ú Î∞îÍøîÏÑú Î≥¥ÎÉÑ
        if ((this.rawUserData.requestStatus === 0 && this.user.userStatus === 1)) this.user.userStatus = 3

        if (this.user.userPermLevel !== 3 || this.user.userPermGroup?.length === 0) {
          this.user.userPermGroup = []
        }
        if (this.user.userPermLevel !== 1 || this.user.userPermRole?.length === 0) {
          this.user.userPermRole = []
        }
        if (this.user.requestUserPermLevel === 3 && this.user.requestStatus === 0 && this.user.userPermLevel === 4) {
          this.user.userPermLevel = 4
        }

        const reqUser = pick(
          this.user,
          [
            'userIdx',
            'userId',
            'userName',
            'userPhoto',
            'userEmail',
            'userGroup',
            'userGroupName',
            'userGroupCode',
            'userCompany',
            'userCompanyName',
            'userCompanyCode',
            'userPosition',
            'userPhone',
            'userDuty',
            'userPermLevel',
            'userPermRole',
            'userPermGroup',
            'userPermRoleList',
            'userPermUpperRoleList',
            'userStatus',
            'loginLock',
            'isMultiUser',
            'userGroupMapMultiList',
            'userGroupMapCustomList',
            'userPw',
            'isBilling'
          ]
        ) // Îã§Î•∏ ÌÇ§ Í∞íÍ≥º Í∞ôÏù¥ Î≥¥ÎÇ¥Î©¥ ÏàòÏ†ï ÏïàÎê©ÎãàÎã§.'

        let isRejected = null

        if (this.rawUserData.requestStatus === 0) {
          if (this.user._userStatus === 3 && this.user._tempUserPermLv === 3) {
            // ÎπåÎßÅ ÏÇ¨Ïö©Ïûê ÏäπÏù∏ ÎåÄÍ∏∞ ÏÉÅÌÉúÏù∏Îç∞, ÌôúÏÑ±ÌôîÎ°ú Î∞îÍøà (ÏäπÏù∏)
            isRejected = false
          } else if (this.user._tempUserPermLv === 4) {
            // ÎπåÎßÅ ÏÇ¨Ïö©Ïûê ÏäπÏù∏ ÎåÄÍ∏∞ ÏÉÅÌÉúÏù∏Îç∞, ÏùºÎ∞ò ÏÇ¨Ïö©Ïûê - ÌôúÏÑ±ÌôîÎ°ú Î∞îÍøà (Î∞òÎ†§)
            isRejected = true
          }
        }

        if (isRejected !== null) reqUser.isRejected = isRejected

        if (!reqUser.userPhone) delete reqUser.userPhone
        if (!reqUser.userEmail) delete reqUser.userEmail
        if (!reqUser.userPw) delete reqUser.userPw

        if (this.isAdmin()) {
          delete reqUser.isMultiUser
          delete reqUser.userGroupMapMultiList
          delete reqUser.userGroupMapCustomList
        }

        if (reqUser.userPhone && !this.$validate.phoneNumber(reqUser.userPhone)) {
          return this.$alert(this.$t('common.ALERT.ACCOUNT.046'), { dangerouslyUseHTMLString: true })
        }

        // const headers = {
        //   userIdx: this.user.userIdx
        // } // local ÌÖåÏä§Ìä∏
        await API.iam.updateUser(reqUser).then(res => {
          this.$alert(this.$t('common.ALERT.ACCOUNT.039'), { // Ï†ïÎ≥¥ ÏàòÏ†ïÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.
            callback: () => {
              const name = this.isAdmin() ? 'set-account-admin' : 'set-account-user'
              return this.routeTo({ name })
            }
          })
        }).catch(err => {
          const code = err.response?.data?.code
          let message
          if (code === 'IAM019') message = this.$t('common.ALERT.ACCOUNT.036') // Ïù¥Ï†ÑÏóê ÏÑ§Ï†ïÌïú ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Îã§Ïãú ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§
          else if (code === 'IAM205') message = this.$t('common.ALERT.ACCOUNT.047') // Ïù¥ÎØ∏ Îì±Î°ùÎêú Ïù¥Î©îÏùºÏûÖÎãàÎã§.
          else if (code === 'IAM211') message = this.$t('common.ALERT.ACCOUNT.048') // ÎèôÏùºÌïú Ìú¥ÎåÄÌè∞ Î≤àÌò∏(Ïó∞ÎùΩÏ≤ò)Í∞Ä Ï°¥Ïû¨Ìï©ÎãàÎã§.<br>ÌôïÏù∏ ÌõÑ ÏûÖÎ†• Î∞îÎûçÎãàÎã§.
          else if (code === 'IAM615') message = this.$t('common.ALERT.ACCOUNT.049') // ÏÜåÏú† Ï§ëÏù∏ ÌîÑÎ°úÏ†ùÌä∏Î•º Ïù¥Í¥ÄÌï† Ïàò ÏûàÎäî<br>Ï§ëÍ∞ÑÍ¥ÄÎ¶¨ÏûêÍ∞Ä Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏäµÎãàÎã§.
          else message = this.$t('common.ALERT.LOGGING.005') // ÏàòÏ†ïÏóê Ïã§Ìå®ÌïòÏòÄÏäµÎãàÎã§. Í¥ÄÎ¶¨Ïûê Î¨∏Ïùò Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.
          this.$alert(message, { dangerouslyUseHTMLString: true })
        })
      }).catch(() => false)
    },
    /**
     * üåû ÏÇ¨Ïö©ÏûêÍ≥ÑÏ†ï, üåô Ïö¥ÏòÅÍ¥ÄÎ¶¨Ïûê Í≥ÑÏ†ï Í≥µÏö©
     * Í∞í validation Ï≤¥ÌÅ¨
     */
    userValidation (user = this.user) {
      const emailReg = this.$validate.emailRaw()
      // const phoneReg = /^\d{2,3}-\d{3,4}-\d{4}$/
      const pwReg = /(?=.*[A-Za-z])(?=.*\d)(?=.*[!#$%&*?@])[A-Za-z\d!#$%&*?@]{8,}$/

      const blankCondition = [
        user.userId && user.userId !== null,
        user.userName && user.userName !== null,
        user.userGroup && user.userGroup !== null,
        user.userPosition && user.userPosition !== null,
        // this.isSsg || (user.userPhone && user.userPhone !== null),
        user._tempUserPermLv !== undefined && user._tempUserPermLv !== null
      ]

      const hasEmailDomain = this.user.userEmail ? (this.groupEmailDomain && this.user.userEmail !== undefined && this.user.userEmail.includes(this.groupEmailDomain)) : true

      let conditions = [
        { condition: blankCondition.every(valid => valid), message: this.$v('ÌïÑÏàòÍ∞íÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.') },
        { condition: validatorUserId(user.userId), message: this.$v('ÏÇ¨Î≤àÏùÄ 4Ïûê Ïù¥ÏÉÅ,<br>50Ïûê Ïù¥ÌïòÎ°ú ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.') },
        { condition: validatorUserName(user.userName), message: this.$v('Ïù¥Î¶ÑÏùÄ 2Ïûê Ïù¥ÏÉÅ,<br>50Ïûê Ïù¥ÌïòÎ°ú ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.') },
        { condition: user.userEmail ? (user.userEmail && emailReg.test(user.userEmail)) : true, message: this.$v('Ïù¥Î©îÏùºÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.') },
        { condition: hasEmailDomain, message: this.groupEmailDomain !== null ? this.$v('Ïù¥Î©îÏùº ÎèÑÎ©îÏù∏ Ï†ïÎ≥¥Í∞Ä Îã§Î¶ÖÎãàÎã§.') : this.$v('Ïù¥Î©îÏùº ÎèÑÎ©îÏù∏Ïù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏùÄ Í¥ÄÍ≥ÑÏÇ¨ÏûÖÎãàÎã§.') }, // ÎèÑÎ©îÏù∏ ÎØ∏Îì±Î°ùÏãú "Ïù¥Î©îÏùº ÎèÑÎ©îÏù∏Ïù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏùÄ Í¥ÄÍ≥ÑÏÇ¨ÏûÖÎãàÎã§" Î¨∏Íµ¨Î°ú Ï∂úÎ†•;
        // { condition: checkUserGroupMap(user), message: checkUserGroupMapMessage(user) }, // Ï∂îÍ∞Ä Î∂ÄÏÑúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.
        { condition: (user._tempUserPermLv === 1 && this.isAdmin()) ? user.userPermRole.length > 0 : true, message: this.$v('Ïó≠Ìï†ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.') },
        { condition: (user._tempUserPermLv === 1 && this.isAdmin()) ? user.userPermRole.every(Boolean) : true, message: this.$v('Ïó≠Ìï†ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.') },
        { condition: user.userPhone ? (this.$validate.phoneNumber(user.userPhone)) : true, message: this.$v('Ìú¥ÎåÄÌè∞ Î≤àÌò∏Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.<br>010-1234-5678 ÌòïÌÉúÎ°ú ÏûÖÎ†•ÎêòÏñ¥Ïïº Ìï©ÎãàÎã§.') }
      ]

      // ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤ΩÏãú
      if (this.isAdmin() && this.otp) {
        conditions = [
          ...conditions,
          { condition: pwReg.test(user.userPw), message: this.$v('ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî. (ÏòÅÎ¨∏Ïûê, Ïà´Ïûê, ÌäπÏàòÎ¨∏Ïûê Ìè¨Ìï® 8Ïûê Ïù¥ÏÉÅ)') },
          { condition: user.userPw === this.userPasswordRe, message: this.$v('ÏûÖÎ†•Ìïú ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏÑúÎ°ú Îã§Î¶ÖÎãàÎã§.') }
        ]
      }

      const validation = conditions.every(cond => {
        if (!cond.condition) this.$alert(cond.message, { dangerouslyUseHTMLString: true })
        return cond.condition
      })

      if (!validation) return false

      return true
    },
    /**
     * üåû ÏÇ¨Ïö©ÏûêÍ≥ÑÏ†ï [Ï∂îÍ∞ÄÎ∂ÄÏÑú]
     * Í¥ÄÍ≥ÑÏÇ¨ Î™©Î°ù Ìò∏Ï∂ú
     */
    async getGroups (payload) {
      try {
        this.loading = true
        const response = await API.iam.getGroupList(payload)
        if (!response) return

        const groupList = response.map(group => {
          const { groupName, groupIdx, companyCode, companyIdx, groupUpperName } = group
          return {
            label: groupName,
            value: groupIdx,
            companyCode: companyCode || null,
            companyIdx: companyIdx || null,
            groupUpperName: groupUpperName || null
          }
        })

        return this.labelSort(groupList)
      } catch (error) {
        console.error('@@ getGroups : ', error)
      } finally {
        this.loading = false
      }
    },
    /**
     * üåû ÏÇ¨Ïö©ÏûêÍ≥ÑÏ†ï
     * [Î©ÄÌã∞ÏÇ¨Ïö©Ïûê] Ï≤¥ÌÅ¨ÌñàÏùÑ Í≤ΩÏö∞ ÎèôÏûë
     */
    setMultiUser (value) {
      // [Í∂åÌïú]ÏùÑ ÌôïÏù∏ÌïòÏó¨ [Í≥ÑÏ†ï ÏÉÅÌÉú]Î•º ÏÑ∏ÌåÖÌï©ÎãàÎã§
      this.setActiveList(this.user)
    },
    /**
     * [Îì±Î°ù email ÌôïÏù∏]
     */
    async initGetGroupManageTree () {
      try {
        this.loading = true
        const response = await API.iam.getGroupManageTree({ project: true, user: false })
        if (response) {
          return response
        }
      } catch (error) {
        console.error('@ initGetGroupManageTree: ', error)
      } finally {
        this.loading = false
      }
    },
    /**
     * üåû ÏÇ¨Ïö©ÏûêÍ≥ÑÏ†ï
     * [Ï∂îÍ∞ÄÎ∂ÄÏÑú] Î™©Î°ù ÏÑ§Ï†ï
     */
    async getGroupManageTree () {
      this.loading = true
      const tree = await JSON.parse(JSON.stringify(this.groupManageTree))

      this.groupTreeData = tree

      this.user._userPermGroupList = []
      this.loading = false
    },
    /**
     * üåû ÏÇ¨Ïö©ÏûêÍ≥ÑÏ†ï, üåô Ïö¥ÏòÅÍ¥ÄÎ¶¨Ïûê Í≥ÑÏ†ï Í≥µÌÜµ
     * Ìï¥Îãπ Í≥ÑÏ†ï ÏÇ¨Ïö©Ïûê/Í¥ÄÎ¶¨Ïûê Ïù∏ÏßÄ ÌôïÏù∏
     * true === 'admin', false === 'user'
     */
    isAdmin (editUser = this.editUser) {
      return editUser.field === 'admin'
    },
    /**
     * üåû ÏÇ¨Ïö©ÏûêÍ≥ÑÏ†ï
     * ÎπåÎßÅÏÇ¨Ïö©ÏûêÏùº Í≤ΩÏö∞, [Ïã†Ï≤≠Ïùº(ÏÉÅÌÉú)] ÎÖ∏Ï∂ú Ïó¨Î∂Ä Í≤∞Ï†ï
     */
    changeAccountAuth (user) {
      // ÎπåÎßÅÏÇ¨Ïö©Ïûê Ïã†Ï≤≠ + ÏäπÏù∏ : ÎπåÎßÅÏÇ¨Ïö©ÏûêÎ°ú ÌëúÍ∏∞(permLv 3)
      // ÎπåÎßÅÏÇ¨Ïö©Ïûê Ïã†Ï≤≠ + ÏäπÏù∏ÎåÄÍ∏∞ : ÎπåÎßÅÏÇ¨Ïö©ÏûêÎ°ú ÌëúÍ∏∞(permLv 4)
      // ÎπåÎßÅÏÇ¨Ïö©Ïûê Ïã†Ï≤≠ + Î∞òÎ†§ : ÏùºÎ∞òÏÇ¨Ïö©ÏûêÎ°ú ÌëúÍ∏∞(permLv 4)

      // Îã§Î•∏ Í∂åÌïúÏùº Í≤ΩÏö∞ Î™®Îëê Î≥¥Ïù¥ÏßÄ ÏïäÏùå
      if (user.requestStatus === undefined) return false

      // ÌòÑÏû¨ ÏÑ†ÌÉùÌïú Í∂åÌïúÏù¥ [ÎπåÎßÅÏÇ¨Ïö©Ïûê]Î©¥, Ï°∞Í±¥ ÎπÑÍµê, Îã§Î•∏ Í∂åÌïúÏúºÎ°ú Î≥ÄÍ≤ΩÏãú false
      if (user._tempUserPermLv === 3 && (user.requestStatus === 0 || user.requestStatus === 1)) return true
      // ÌòÑÏû¨ ÏÑ†ÌÉùÌïú Í∂åÌïúÏù¥ [ÏùºÎ∞òÏÇ¨Ïö©Ïûê]Î©¥, Ï°∞Í±¥ ÎπÑÍµê, Îã§Î•∏Í∂åÌïúÏúºÎ°ú Î≥ÄÍ≤ΩÏãú false
      if (user._tempUserPermLv === 4 && user.requestStatus === 2) return true
      return false
    }
  },
  data () {
    return {
      isDataLoaded: false,
      fileList: [],
      changedOrgOrAff: false,
      groupEmailDomain: null,
      otpModalActive: false,
      otp: false,
      allGroups: null,
      userGroupList: null,
      disapproveModal: false,
      groupManageTree: [],
      groupTreeData: [],
      /// ///
      editUser: {
        userId: undefined,
        field: undefined
      },
      rawUserData: {},
      user: {
        userId: '',
        userPw: '',
        userName: '',
        userCompany: '',
        userGroup: '',
        userPosition: '',
        userEmail: '',
        userPhone: '',
        userPermLevel: 1,
        userPermRole: [],
        userPermGroup: [],
        userPhoto: '',
        userStatus: 0,
        loginLock: false,
        addPermGroup: [],
        isBilling: false
      },
      userPasswordRe: '',
      companyList: [],
      groupList: [],
      positionList: [
        { field: 'Ï∞®Ïû•', label: 'Ï∞®Ïû•' },
        { field: 'ÌåÄÏû•', label: 'ÌåÄÏû•' },
        { field: 'Î∂ÄÏû•', label: 'Î∂ÄÏû•' },
        { field: 'Í≥ºÏû•', label: 'Í≥ºÏû•' },
        { field: 'ÎåÄÎ¶¨', label: 'ÎåÄÎ¶¨' },
        { field: 'Ï£ºÏûÑ', label: 'Ï£ºÏûÑ' },
        { field: 'ÏÇ¨Ïõê', label: 'ÏÇ¨Ïõê' }
      ],
      activeList: [
        { field: 3, label: 'ÌôúÏÑ±Ìôî', keyPath: 'admin.ACCOUNT.actived' },
        // { field: 1, label: 'ÏäπÏù∏ÎåÄÍ∏∞', keyPath: 'admin.ACCOUNT.waitApproval' }, // ÎπåÎßÅÏÇ¨Ïö©Ïûê
        { field: 0, label: 'ÎπÑÌôúÏÑ±Ìôî', keyPath: 'admin.ACCOUNT.inactived' }
        // { field: 4, label: 'Ìá¥ÏÇ¨', keyPath: 'admin.ACCOUNT.resigned' }
      ],
      // 3 ÎπåÎßÅÏÇ¨Ïö©Ïûê, 4, ÏùºÎ∞ò ÏÇ¨Ïö©Ïûê, 5 Ïª§Ïä§ÌÖÄ ÏÇ¨Ïö©Ïûê, 6 ÌòëÎ†•ÏÇ¨
      userPermLevels: [
        { label: this.$t('admin.ACCOUNT.generalUser'), value: 4 }, // ÏùºÎ∞òÏÇ¨Ïö©Ïûê
        // { label: this.$t('admin.ACCOUNT.billingUser'), value: 3 }, // ÎπåÎßÅÏÇ¨Ïö©Ïûê
        // { label: this.$t('admin.ACCOUNT.customUser'), value: 5 }, // Ïª§Ïä§ÌÖÄ ÏÇ¨Ïö©Ïûê
        { label: this.$t('admin.ACCOUNT.middleManager'), value: 2 } // Ï§ëÍ∞ÑÍ¥ÄÎ¶¨Ïûê
      ],
      // 0 ÏµúÍ≥†Í¥ÄÎ¶¨Ïûê, 1 Ïö¥ÏòÅÍ¥ÄÎ¶¨Ïûê
      admPermLevels: [
        { label: this.$t('admin.ACCOUNT.managerSimple'), value: 1 }, // Ïö¥ÏòÅÍ¥ÄÎ¶¨Ïûê
        { label: this.$t('admin.ACCOUNT.topManagerSimple'), value: 0 } // ÏµúÍ≥†Í¥ÄÎ¶¨Ïûê
        // 0 ÏµúÍ≥†Í¥ÄÎ¶¨Ïûê, 1 Ïö¥ÏòÅÍ¥ÄÎ¶¨Ïûê
      ],
      loginLockList: [
        { field: true, label: 'Y' },
        { field: false, label: 'N' }
      ],
      roleList: [],
      isSsg: false,
      isChange: false,
      loading: false,
      settingFin: false,
      tempAddDepartData: {
        companyIdx: null,
        companyName: null,
        groupIdx: null,
        groupName: null
      },
      labelSort (data) { // ÏàúÏÑú Ï†ïÎ¶¨
        return data.sort((a, b) => {
          if (a.label > b.label) return 1
          else if (a.label < b.label) return -1
          else return 0
        })
      }
    }
  }
}
</script>

<style lang="scss">
.set-account-detail {
  > .edit-area {
    .edit-info-list {
      margin-top: -1px;
      border-bottom: 1px solid $dark-slate;
      .information-input {
        width: 500px;
      }
      & + .info-item {
        margin-top: $gap;
      }
      .input-form {
        display: flex;
        position: relative;
        width: 500px;
        > .el-radio-group {
          display: flex;
          align-items: center;
        }
        &.-role {
          &.admin {
            width: 435px;
          }
          flex-direction: column;
          .form-role {
            display: flex;
            align-items: center;
            width: 100%;
            & + .form-role {
              margin-top: $gap-s;
            }
            & > .el-input {
              &:first-of-type {
                margin-right: 5px;
              }
            }
          }
          .-add-button {
            position: absolute;
            bottom: 1px;
            right: -$gap-m;
            color: $primary;
          }
          .-delete-button {
            margin-left: $gap-s;
            color: $primary;
          }
        }
        &.display-input-form {
          box-sizing: border-box;
          background-color: #171a1d;
          padding: 10px 10px 0 10px;
          border: 1px solid #171a1d;
          height: auto;
          min-height: 54px;
          max-height: 250px;
          &.no-data {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #606266;
          }
        }
        &.add-input-form {
          margin-bottom: 10px;
          .form-role {
            .el-select {
              &:first-of-type {
                margin-right: 5px;
              }
            }
            .-add-depart-button {
              margin-left: $gap-s;
              color: $primary;
            }
          }
        }
      }
      .flex-wrap {
        display: flex;
        align-items: center;
        .pw-info {
          margin-left: $gap-s;
          font-size: 1em;
          color: #c0c4cc;
        }
      }
    }
    .-search-id-button {
      width: 120px;
      margin-left: 5px;
    }
  }

  .photo-form {
    display: inline-block;

    .photo-view {
      display: inline-block;
      margin-top: $gap;

      .photo-image {
        cursor: pointer;
      }
    }
  }
}

.data-empty {
  width:500px;
  text-align:center;
  font-size:14px;
  font-weight:500;
  color:#c0c4cc;
  padding: 50px 0px;
}

</style>
